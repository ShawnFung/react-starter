# çŠ¶æ€ç®¡ç†

React çŠ¶æ€ç®¡ç†çš„æ–¹å¼
- è‡ªå¸¦çš„ Context useReducer
- Redux
- Mobx

## Context
- å‘ä¸‹çº§ç»„ä»¶ï¼Œè·¨ç»„ä»¶ä¼ é€’ä¿¡æ¯ï¼Œç±»ä¼¼ Vue çš„ provide/inject
- Context åªé€‚åˆç»Ÿä¸€è®¾ç½®ã€ä¸‹å‘æŸäº›å…¨å±€å˜é‡ï¼ˆè¯­è¨€ï¼Œä¸»é¢˜ç­‰ï¼‰ï¼Œåº”ç”¨åœºæ™¯æ¯”è¾ƒå•ä¸€
```ts  index.tsx
// åˆ›å»º Context
export const ThemeContext = React.createContext('')

// ç”¨ xxx.Provider åŒ…è£¹ç»„ä»¶æ ‘ä¸­çš„æ ¹èŠ‚ç‚¹ï¼Œå¹¶ä¼ é€’ value å€¼
function Parent(){
  return <>
    <ThemeContext.Provider value="light">
      <div>xxx</div>
    </ThemeContext.Provider>
  </>
}
```
```ts
import { ThemeContext } from './index.tsx'

function Grandson(){

  // è¯»å– context çš„å€¼
  const level = useContext(ThemeContext);
  return <></>
}
```

## useReducer
- useState çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå½“æ•°æ®ç®€å•æ—¶ç”¨ `useState` ï¼Œå½“æ•°æ®ç»“æ„è¾ƒä¸ºå¤æ‚æ—¶ï¼Œå¯ä»¥è€ƒè™‘ç”¨ `useReducer`
- å‚è€ƒäº† redux çš„è®¾è®¡ï¼Œä¸€ä¸ªç®€åŒ–ç‰ˆçš„ redux
- è·¨ç»„ä»¶é€šä¿¡ï¼Œéœ€è¦æ­é… Context ä¸€èµ·ä½¿ç”¨
```ts
type StateType = { count: number }
type ActionType = { type: stringï¼Œ payload?: any }

const initialState = { count: 100 }
const reducer = (state: StateType, action: ActionType){
  switch(action.type){
    case 'increment':
      return { count: state.count + 1}
    case 'decrement':
      return { count: state.count - 1 }
    default: 
      throw new Error('')
  }
}

const countReducer = () => {
  const [state, dispatch] = useReducer(reducer, initialState)

  function increment(){
    dispatch({ type: 'increment' })
  }

  return <>
      <span>count:{ state.count }</span>
      <button onClick={increment} >+</button>
    </>
}
```

### æ¦‚å¿µ
- state æˆ– store - å­˜å‚¨æ•°æ®
- action - åŠ¨ä½œï¼Œæ ¼å¼å¦‚ `{ type: 'xxx', ... }`
- reducer - æ ¹æ® action ç”Ÿæˆæ–° state â€”â€” **ä¸å¯å˜æ•°æ®**
- dispatch - è§¦å‘ action

## [Redux](https://www.reduxjs.cn/) å•å‘æ•°æ®æµ
[react-redux](https://cn.react-redux.js.org/)

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux toolkitï¼Ÿ
- ä¼ ç»Ÿ Redux Store çš„é…ç½®è¾ƒä¸ºå¤æ‚
- ä¼ ç»Ÿ Redux éœ€è¦å®‰è£…å¾ˆå¤šä¾èµ–åŒ…
- ä¼ ç»Ÿ Redux éœ€è¦ç¼–å†™å¤§é‡çš„æ ·æ¿ä»£ç 

### å®‰è£…
```
npm install @reduxjs/toolkit react-redux
```

### å¼€å‘æµç¨‹
- ä½¿ç”¨ `configureStore` åˆ›å»º Redux store
  - `configureStore` æ¥æ”¶ reducer å‡½æ•°ä½œä¸ºå‘½åå‚æ•°
  - `configureStore` ä½¿ç”¨è‰¯å¥½çš„é»˜è®¤è®¾ç½®è‡ªåŠ¨è®¾ç½® store
- ä¸º React åº”ç”¨ç¨‹åºç»„ä»¶æä¾› Redux store
  - åœ¨ä½ çš„ `<App />` å¤–å±‚åŒ…è£¹ä¸€ä¸ª React Redux `<Provider>` ç»„ä»¶
  - å°† Redux store ä½œä¸º `<Provider store={store}>` ä¼ é€’
- ä½¿ç”¨ `createSlice` åˆ›å»ºä¸€ä¸ª Redux slice reducer
  - ä½¿ç”¨å­—ç¬¦ä¸²åç§°ï¼Œåˆå§‹ state å’Œå‘½åçš„ reducer å‡½æ•°è°ƒç”¨ `createSlice`
  - Reducer å‡½æ•°å¯ä»¥ä½¿ç”¨ Immer æ¥ mutate state
  - å¯¼å‡ºç”Ÿæˆçš„ slice reducer å’Œ action creators
- åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ React Redux `useSelector`/`useDispatch` hooks
  - ä½¿ç”¨ `useSelector` hook ä» store è¯»å–æ•°æ®
  - ä½¿ç”¨ `useDispatch` hook è·å– dispatch å‡½æ•°ï¼Œå¹¶æ ¹æ®éœ€è¦ dispatch actions

### å¦‚ä½•å®ç°ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚
- `createAsyncThunk`
- `extraReducers`
```ts
// è¯·æ±‚ç”µå½±åˆ—è¡¨
const getMovieListApi = ()=> 
  fetch(
    'https://pcw-api.iqiyi.com/search/recommend/list?channel_id=1&data_type=1&mode=24&page_id=1&ret_num=48'
  ).then(res => res.json())

// thunkå‡½æ•°å…è®¸æ‰§è¡Œå¼‚æ­¥é€»è¾‘, é€šå¸¸ç”¨äºå‘å‡ºå¼‚æ­¥è¯·æ±‚ã€‚
// createAsyncThunk åˆ›å»ºä¸€ä¸ªå¼‚æ­¥actionï¼Œæ–¹æ³•è§¦å‘çš„æ—¶å€™ä¼šæœ‰ä¸‰ç§çŠ¶æ€ï¼š
// pendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆæˆåŠŸï¼‰ã€rejectedï¼ˆå¤±è´¥ï¼‰
export const getMovieData = createAsyncThunk( 'movie/getMovie', 
  async () => await getMovieListApi()
);

// åˆ›å»ºä¸€ä¸ª Slice 
export const movieSlice = createSlice({
  name: 'movie',
  initialState: [
    list: [],
    totals: 0
  ],
  reducers: {},
  // extraReducers å­—æ®µè®© slice å¤„ç†åœ¨åˆ«å¤„å®šä¹‰çš„ actionsï¼Œ 
  // åŒ…æ‹¬ç”± createAsyncThunk æˆ–å…¶ä»–sliceç”Ÿæˆçš„actionsã€‚
  extraReducers(builder) {
    builder
      .addCase(getMovieData.pending, (state) => {
        console.log("ğŸš€ ~ è¿›è¡Œä¸­ï¼")
      })
      .addCase(getMovieData.fulfilled, (state, {payload}) => {
        console.log("ğŸš€ ~ fulfilled", payload);
        state.list = payload.data.list
        state.totals = payload.data.list.length
      })
      .addCase(getMovieData.rejected, (state, err) => {
        console.log("ğŸš€ ~ rejected", err)
      });
  },
});
```

### å…¶ä»–
- Redux DevTools 

## [Mobx](https://www.mobxjs.com/)

### å®‰è£…
```
npm install mobx mobx-react
```

## å‚è€ƒæ–‡æ¡£
- [Redux æœ€ä½³å®è·µ Redux Toolkit](https://juejin.cn/post/7101688098781659172)